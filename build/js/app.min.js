var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),farallonBase=function(){function e(){this.is_single=!1,this.post_id=0,this.is_archive=!1,this.darkmode=!1,this.is_single=obvInit.is_single,this.post_id=obvInit.post_id,this.is_archive=obvInit.is_archive,this.darkmode=obvInit.darkmode,this.VERSION=obvInit.version}return e.prototype.getCookie=function(e){if(0<document.cookie.length){var t=document.cookie.indexOf(e+"=");if(-1!=t)return t=t+e.length+1,-1==(e=document.cookie.indexOf(";",t))&&(e=document.cookie.length),document.cookie.substring(t,e)}return""},e.prototype.setCookie=function(e,t,o){var n=new Date,o=(n.setTime(n.getTime()+24*o*60*60*1e3),"expires="+n.toUTCString());document.cookie=e+"="+t+";"+o+";path=/"},e.prototype.showNotice=function(e,t){void 0===t&&(t="success");t='<div class="notice--wrapper">'.concat(e,"</div>");document.querySelector("body").insertAdjacentHTML("beforeend",t),document.querySelector(".notice--wrapper").classList.add("is-active"),setTimeout(function(){document.querySelector(".notice--wrapper").remove()},3e3)},e}(),farallonAction=function(o){function e(){var e=o.call(this)||this,t=(e.selctor=".like-btn",e.is_single=!1,e.post_id=0,e.is_archive=!1,e.is_single=obvInit.is_single,e.post_id=obvInit.post_id,e.is_archive=obvInit.is_archive,e.like_btn=document.querySelector(e.selctor),e.like_btn&&(e.like_btn.addEventListener("click",function(){e.handleLike()}),e.getCookie("like_"+e.post_id))&&e.like_btn.classList.add("is-active"),localStorage.getItem("theme")?localStorage.getItem("theme"):"auto"),t='<div class="fixed--theme">\n        <span class="'.concat("dark"==t?"is-active":"",'" data-action-value="dark">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>\n            </svg>\n        </span>\n        <span class="').concat("light"==t?"is-active":"",'" data-action-value="light">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <circle cx="12" cy="12" r="5"></circle>\n                <path d="M12 1v2"></path>\n                <path d="M12 21v2"></path>\n                <path d="M4.22 4.22l1.42 1.42"></path>\n                <path d="M18.36 18.36l1.42 1.42"></path>\n                <path d="M1 12h2"></path>\n                <path d="M21 12h2"></path>\n                <path d="M4.22 19.78l1.42-1.42"></path>\n                <path d="M18.36 5.64l1.42-1.42"></path>\n            </svg>\n        </span>\n        <span class="').concat("auto"==t?"is-active":"",'"  data-action-value="auto">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                <path d="M8 21h8"></path>\n                <path d="M12 17v4"></path>\n            </svg>\n        </span>\n    </div>'),t=(e.darkmode&&document.querySelector("body").insertAdjacentHTML("beforeend",t),document.querySelectorAll(".fixed--theme span").forEach(function(e){e.addEventListener("click",function(){e.classList.contains("is-active")||(document.querySelectorAll(".fixed--theme span").forEach(function(e){e.classList.remove("is-active")}),"dark"==e.dataset.actionValue?(localStorage.setItem("theme","dark"),document.querySelector("body").classList.remove("auto"),document.querySelector("body").classList.add("dark"),e.classList.add("is-active")):"light"==e.dataset.actionValue?(localStorage.setItem("theme","light"),document.querySelector("body").classList.remove("auto"),document.querySelector("body").classList.remove("dark"),e.classList.add("is-active")):"auto"==e.dataset.actionValue&&(localStorage.setItem("theme","auto"),document.querySelector("body").classList.remove("dark"),document.querySelector("body").classList.add("auto"),e.classList.add("is-active")))})}),document.querySelector(".post--share")&&document.querySelector(".post--share").addEventListener("click",function(){navigator.clipboard.writeText(document.location.href).then(function(){e.showNotice("复制成功")})}),document.querySelector('[data-action="show-search"]').addEventListener("click",function(){document.querySelector(".site--header__center .inner").classList.toggle("search--active")}),e.is_single&&e.trackPostView(),e.is_archive,console.log("theme version: ".concat(e.VERSION," init success!")),'<div class="site--footer__info">\n        Theme <a href="https://fatesinger.com/101971" target="_blank">farallon</a> by bigfa / version '.concat(e.VERSION,"\n    </div>"));return document.querySelector(".site--footer__content").insertAdjacentHTML("afterend",t),document.querySelector(".icon--copryrights").addEventListener("click",function(){document.querySelector(".site--footer__info").classList.toggle("active")}),e}return __extends(e,o),e.prototype.trackPostView=function(){var e=obvInit.post_id,e=obvInit.restfulBase+"farallon/v1/view?id="+e;fetch(e,{headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.log(e)})},e.prototype.trackArchiveView=function(){var e;document.querySelector(".archive-header")&&(e=document.querySelector(".archive-header").dataset.id,fetch("/api/archive/".concat(e)))},e.prototype.handleLike=function(){var t=this;if(this.getCookie("like_"+this.post_id))return this.showNotice("You have already liked this post");var e=obvInit.restfulBase+"farallon/v1/like";fetch(e,{method:"POST",body:JSON.stringify({id:this.post_id}),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){t.showNotice("Thanks for your like"),t.setCookie("like_"+t.post_id,"1",1)}),this.like_btn.classList.add("is-active")},e.prototype.refresh=function(){},e}(farallonBase),farallonComment=(new farallonAction,function(t){function e(){var e=t.call(this)||this;return e.loading=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){var e,r=this;document.querySelector(".comment-form")&&null!=(e=document.querySelector(".comment-form"))&&e.addEventListener("submit",function(e){var o;e.preventDefault(),r.loading||(e=document.querySelector(".comment-form"),e=new FormData(e),o={},e.forEach(function(e,t){return o[t]=e}),r.loading=!0,fetch(obvInit.restfulBase+"farallon/v1/comment",{method:"POST",body:JSON.stringify(o),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(r.loading=!1,200!=e.code)return r.showNotice(e.message,"error");var t=document.getElementById("cancel-comment-reply-link"),o=document.getElementById("respond"),n=document.getElementById("wp-temp-form-div"),e=e.data,i='<li class="comment" id="comment-'.concat(e.comment_ID,'">\n                        <div class="comment-body comment-body__fresh">\n                            <footer class="comment-meta">\n                                <div class="comment--avatar">\n                                    <img alt="" src="').concat(e.author_avatar_urls,'" class="avatar" height="42" width="42" />\n                                </div>\n                                <div class="comment--meta">\n                                    <div class="comment--author">').concat(e.comment_author,'<span class="dot"></span>\n                                    <time>刚刚</time>\n                                    </div>\n                                </div>\n                            </footer>\n                            <div class="comment-content">\n                                ').concat(e.comment_content,"\n                            </div>\n                        </div>\n                    </li>"),c=null==(c=document.querySelector("#comment_parent"))?void 0:c.value,o=(t.style.display="none",t.onclick=null,document.getElementById("comment_parent").value="0",n&&o&&(n.parentNode.insertBefore(o,n),n.parentNode.removeChild(n)),document.querySelector(".comment-body__fresh")&&null!=(t=document.querySelector(".comment-body__fresh"))&&t.classList.remove("comment-body__fresh"),document.getElementById("comment").value="","0"!=c?(null!=(o=document.querySelector("#comment-"+c))&&o.insertAdjacentHTML("beforeend",'<ol class="children">'+i+"</ol>"),console.log(c)):(document.querySelector(".no--comment")&&null!=(n=document.querySelector(".no--comment"))&&n.remove(),null!=(t=document.querySelector(".commentlist"))&&t.insertAdjacentHTML("beforeend",i)),document.querySelector("#comment-".concat(e.comment_ID)));o&&o.scrollIntoView({behavior:"smooth"}),r.showNotice("评论成功")}))})},e}(farallonBase)),farallonDate=(new farallonComment,function(){function e(e){var t=this;this.doms=[],this.selector=e.selector,this.init(),setTimeout(function(){t.refresh()},5e3)}return e.prototype.init=function(){var t=this;this.doms=Array.from(document.querySelectorAll(this.selector)),this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e.prototype.humanize_time_ago=function(e){var e=new Date(e),t=Date.now()/1e3-Number(e.getTime()/1e3);return t<3600?"".concat(Math.ceil(t/60)," 分钟前"):t<86400?"".concat(Math.ceil(t/3600)," 小时前"):t<2592e3?"".concat(Math.ceil(t/86400)," 天前"):t<31104e3?"".concat(Math.ceil(t/2592e3)," 月前"):e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},e.prototype.refresh=function(){var t=this;this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e}()),farallonScroll=(new farallonDate({selector:".humane--time"}),function(){function e(){this.is_single=!1,this.is_single=obvInit.is_single,this.init()}return e.prototype.init=function(){this.scroll()},e.prototype.scroll=function(){var t=this,e=document.querySelector(".post-navigation"),o=e?e.offsetTop:0,n=window.innerHeight;window.addEventListener("scroll",function(){var e;10<window.scrollY?null!=(e=document.querySelector(".site--header"))&&e.classList.add("is-active"):null!=(e=document.querySelector(".site--header"))&&e.classList.remove("is-active"),t.is_single&&(window.scrollY>o-n?null!=(e=document.querySelector(".post-navigation"))&&e.classList.add("is-active"):null!=(e=document.querySelector(".post-navigation"))&&e.classList.remove("is-active"))})},e}());new farallonScroll;
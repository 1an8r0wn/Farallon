var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),farallonBase=function(){function t(){this.is_single=!1,this.post_id=0,this.is_archive=!1,this.is_single=obvInit.is_single,this.post_id=obvInit.post_id,this.is_archive=obvInit.is_archive,this.is_single&&this.trackPostView(),this.is_archive&&this.trackArchiveView()}return t.prototype.getCookie=function(t){if(0<document.cookie.length){var e=document.cookie.indexOf(t+"=");if(-1!=e)return e=e+t.length+1,-1==(t=document.cookie.indexOf(";",e))&&(t=document.cookie.length),document.cookie.substring(e,t)}return""},t.prototype.setCookie=function(t,e,o){var n=new Date,o=(n.setTime(n.getTime()+24*o*60*60*1e3),"expires="+n.toUTCString());document.cookie=t+"="+e+";"+o+";path=/"},t.prototype.trackPostView=function(){var t=obvInit.post_id,e=obvInit.restfulBase+"farallon/v1/post/view";fetch(e,{method:"POST",body:JSON.stringify({id:t})})},t.prototype.trackArchiveView=function(){var t;document.querySelector(".archive-header")&&(t=document.querySelector(".archive-header").dataset.id,fetch("/api/archive/".concat(t)))},t}(),farallonAction=(new farallonBase,function(e){function t(){var t=e.call(this)||this;return t.selctor=".like-btn",t.like_btn=document.querySelector(t.selctor),t.like_btn&&t.like_btn.addEventListener("click",function(){t.handleLike()}),console.log("init"),document.querySelector('[data-action="show-search"]').addEventListener("click",function(){document.querySelector(".site--header__center .inner").classList.toggle("search--active")}),document.querySelectorAll(".fixed--theme span").forEach(function(t){t.addEventListener("click",function(){document.querySelector("body").classList.toggle("dark--theme"),t.classList.toggle("is-active")})}),t}return __extends(t,e),t.prototype.handleLike=function(){var t;this.getCookie("like_"+this.post_id)||(t=obvInit.restfulBase+"farallon/v1/post/view",fetch(t,{method:"POST",body:JSON.stringify({id:this.post_id})}),this.like_btn.classList.add("is-active"))},t.prototype.refresh=function(){},t}(farallonBase)),farallonComment=(new farallonAction,function(){function t(){this.init()}return t.prototype.init=function(){var t;console.log("farallonComment"),document.querySelector(".comment-form")&&null!=(t=document.querySelector(".comment-form"))&&t.addEventListener("submit",function(t){t.preventDefault();var t=document.querySelector(".comment-form"),t=new FormData(t),o={};t.forEach(function(t,e){return o[e]=t}),fetch(obvInit.restfulBase+"farallon/v1/comment",{method:"POST",body:JSON.stringify(o),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){console.log("ss");var e,t=t.data,t='<li id="comment-10908" class="comment byuser comment-author-bigfa bypostauthor odd alt thread-even depth-1">\n                    <article id="div-comment-10908" class="comment-body">\n                        <footer class="comment-meta">\n                            <div class="comment-author vcard">\n                                <img alt="" src="http://2.gravatar.com/avatar/5ba655c9abcbd5f81a3ce0d1a88dc568?s=48&amp;d=mm&amp;r=x" srcset="http://2.gravatar.com/avatar/5ba655c9abcbd5f81a3ce0d1a88dc568?s=96&amp;d=mm&amp;r=x 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy" decoding="async">\t\t\t\t\t\t<b class="fn">'.concat(t.comment_author,'</b><span class="says">说道：</span>\t\t\t\t\t</div>\x3c!-- .comment-author --\x3e\n        \n                            <div class="comment-metadata">\n                                <a href="http://localhost/101092#comment-10908"><time datetime="2023-06-29T16:30:48+08:00">6月 29, 2023 4:30 下午</time></a></div>\x3c!-- .comment-metadata --\x3e\n        \n                                            </footer>\x3c!-- .comment-meta --\x3e\n        \n                        <div class="comment-content">\n                            ').concat(t.comment_content,'\n                        </div>\x3c!-- .comment-content --\x3e\n        \n                        <div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://localhost/101092?replytocom=10908#respond" data-commentid="10908" data-postid="101092" data-belowelement="div-comment-10908" data-respondelement="respond" data-replyto="回复给bigfa" aria-label="回复给bigfa">回复</a></div>\t\t\t</article>\x3c!-- .comment-body --\x3e\n                </li>');null!=(e=document.querySelector(".commentlist"))&&e.insertAdjacentHTML("beforeend",t)})})},t}()),farallonDate=(new farallonComment,function(){function t(t){var e=this;this.doms=[],this.selector=t.selector,this.init(),setTimeout(function(){e.refresh()},5e3)}return t.prototype.init=function(){var e=this;this.doms=Array.from(document.querySelectorAll(this.selector)),this.doms.forEach(function(t){t.innerText=e.humanize_time_ago(t.attributes.datetime.value)})},t.prototype.humanize_time_ago=function(t){t=new Date(t),t=Date.now()/1e3-Number(t.getTime()/1e3);return t<3600?"".concat(Math.ceil(t/60)," 分钟前"):t<86400?"".concat(Math.ceil(t/3600)," 小时前"):t<2592e3?"".concat(Math.ceil(t/2073600)," 天前"):"".concat(Math.ceil(t/62208e3)," 月前")},t.prototype.refresh=function(){var e=this;this.doms.forEach(function(t){t.innerText=e.humanize_time_ago(t.attributes.datetime.value)})},t}()),farallonScroll=(new farallonDate({selector:".humane--time"}),function(){function t(){this.init()}return t.prototype.init=function(){this.scroll()},t.prototype.scroll=function(){document.querySelector(".author--card").offsetTop,window.innerHeight;window.addEventListener("scroll",function(){var t;10<window.scrollY?null!=(t=document.querySelector(".site--header"))&&t.classList.add("is-active"):null!=(t=document.querySelector(".site--header"))&&t.classList.remove("is-active")})},t}());new farallonScroll;
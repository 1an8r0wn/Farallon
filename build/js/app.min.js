var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),farallonBase=function(){function t(){this.is_single=!1,this.post_id=0,this.is_archive=!1,this.is_single=obvInit.is_single,this.post_id=obvInit.post_id,this.is_archive=obvInit.is_archive}return t.prototype.getCookie=function(t){if(0<document.cookie.length){var e=document.cookie.indexOf(t+"=");if(-1!=e)return e=e+t.length+1,-1==(t=document.cookie.indexOf(";",e))&&(t=document.cookie.length),document.cookie.substring(e,t)}return""},t.prototype.setCookie=function(t,e,n){var o=new Date,n=(o.setTime(o.getTime()+24*n*60*60*1e3),"expires="+o.toUTCString());document.cookie=t+"="+e+";"+n+";path=/"},t}(),farallonAction=(new farallonBase,function(e){function t(){var t=e.call(this)||this;return t.selctor=".like-btn",t.is_single=!1,t.post_id=0,t.is_archive=!1,t.is_single=obvInit.is_single,t.post_id=obvInit.post_id,t.is_archive=obvInit.is_archive,t.like_btn=document.querySelector(t.selctor),t.like_btn&&t.like_btn.addEventListener("click",function(){t.handleLike()}),console.log("init"),document.querySelector('[data-action="show-search"]').addEventListener("click",function(){document.querySelector(".site--header__center .inner").classList.toggle("search--active")}),document.querySelectorAll(".fixed--theme span").forEach(function(t){t.addEventListener("click",function(){document.querySelector("body").classList.toggle("dark--theme"),t.classList.toggle("is-active")})}),t.is_single&&t.trackPostView(),t.is_archive&&t.trackArchiveView(),t}return __extends(t,e),t.prototype.trackPostView=function(){var t=obvInit.post_id,t=obvInit.restfulBase+"farallon/v1/view?id="+t;fetch(t,{headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){console.log(t)})},t.prototype.trackArchiveView=function(){var t;document.querySelector(".archive-header")&&(t=document.querySelector(".archive-header").dataset.id,fetch("/api/archive/".concat(t)))},t.prototype.handleLike=function(){var t;this.getCookie("like_"+this.post_id)||(t=obvInit.restfulBase+"farallon/v1/like",fetch(t,{method:"POST",body:JSON.stringify({id:this.post_id}),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){console.log(t)}),this.like_btn.classList.add("is-active"))},t.prototype.refresh=function(){},t}(farallonBase)),farallonComment=(new farallonAction,function(){function t(){this.loading=!1,this.init()}return t.prototype.init=function(){var t,c=this;console.log("farallonComment"),document.querySelector(".comment-form")&&null!=(t=document.querySelector(".comment-form"))&&t.addEventListener("submit",function(t){var n;t.preventDefault(),c.loading||(t=document.querySelector(".comment-form"),t=new FormData(t),n={},t.forEach(function(t,e){return n[e]=t}),c.loading=!0,fetch(obvInit.restfulBase+"farallon/v1/comment",{method:"POST",body:JSON.stringify(n),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){var e,n,o,i;c.loading=!1,200==t.code&&(e=document.getElementById("cancel-comment-reply-link"),n=document.getElementById("respond"),o=document.getElementById("wp-temp-form-div"),t=t.data,t='<li class="comment byuser comment-author-bigfa bypostauthor odd alt thread-even depth-1">\n                    <article class="comment-body">\n                        <footer class="comment-meta">\n                            <div class="comment-author vcard">\n                                <img alt="" src="'.concat(t.author_avatar_urls,'" class="avatar avatar-48 photo" height="48" width="48" />\t\t\t\t\t\t<b class="fn">').concat(t.comment_author,'</b><span class="says">说道：</span>\t\t\t\t\t</div>\x3c!-- .comment-author --\x3e\n        \n                            <div class="comment-metadata">\n                               <time>').concat(t.comment_date,'</time></div>\x3c!-- .comment-metadata --\x3e\n        \n                                            </footer>\x3c!-- .comment-meta --\x3e\n        \n                        <div class="comment-content">\n                            ').concat(t.comment_content,"\n                        </div>\x3c!-- .comment-content --\x3e\n        \n                        </article>\x3c!-- .comment-body --\x3e\n                </li>"),i=null==(i=document.querySelector("#comment_parent"))?void 0:i.value,console.log(!i),e.style.display="none",e.onclick=null,document.getElementById("comment_parent").value="0",o&&n&&(o.parentNode.insertBefore(n,o),o.parentNode.removeChild(o)),document.getElementById("comment").value="",i?(null!=(e=document.querySelector("#comment-"+i))&&e.insertAdjacentHTML("beforeend",'<ol class="children">'+t+"</ol>"),console.log(i)):(null!=(n=document.querySelector(".commentlist"))&&n.insertAdjacentHTML("beforeend",t),console.log(2)))}))})},t}()),farallonDate=(new farallonComment,function(){function t(t){var e=this;this.doms=[],this.selector=t.selector,this.init(),setTimeout(function(){e.refresh()},5e3)}return t.prototype.init=function(){var e=this;this.doms=Array.from(document.querySelectorAll(this.selector)),this.doms.forEach(function(t){t.innerText=e.humanize_time_ago(t.attributes.datetime.value)})},t.prototype.humanize_time_ago=function(t){t=new Date(t),t=Date.now()/1e3-Number(t.getTime()/1e3);return t<3600?"".concat(Math.ceil(t/60)," 分钟前"):t<86400?"".concat(Math.ceil(t/3600)," 小时前"):t<2592e3?"".concat(Math.ceil(t/2073600)," 天前"):"".concat(Math.ceil(t/62208e3)," 月前")},t.prototype.refresh=function(){var e=this;this.doms.forEach(function(t){t.innerText=e.humanize_time_ago(t.attributes.datetime.value)})},t}()),farallonScroll=(new farallonDate({selector:".humane--time"}),function(){function t(){this.init()}return t.prototype.init=function(){this.scroll()},t.prototype.scroll=function(){document.querySelector(".author--card").offsetTop,window.innerHeight;window.addEventListener("scroll",function(){var t;10<window.scrollY?null!=(t=document.querySelector(".site--header"))&&t.classList.add("is-active"):null!=(t=document.querySelector(".site--header"))&&t.classList.remove("is-active")})},t}());new farallonScroll;
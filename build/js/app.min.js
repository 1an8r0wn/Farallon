var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),farallonBase=function(){function e(){this.is_single=!1,this.post_id=0,this.is_archive=!1,this.is_single=obvInit.is_single,this.post_id=obvInit.post_id,this.is_archive=obvInit.is_archive}return e.prototype.getCookie=function(e){if(0<document.cookie.length){var t=document.cookie.indexOf(e+"=");if(-1!=t)return t=t+e.length+1,-1==(e=document.cookie.indexOf(";",t))&&(e=document.cookie.length),document.cookie.substring(t,e)}return""},e.prototype.setCookie=function(e,t,n){var o=new Date,n=(o.setTime(o.getTime()+24*n*60*60*1e3),"expires="+o.toUTCString());document.cookie=e+"="+t+";"+n+";path=/"},e.prototype.showNotice=function(e,t){void 0===t&&(t="success");t='<div class="notice--wrapper">'.concat(e,"</div>");document.querySelector("body").insertAdjacentHTML("beforeend",t),document.querySelector(".notice--wrapper").classList.add("is-active"),setTimeout(function(){document.querySelector(".notice--wrapper").remove()},3e3)},e}(),farallonAction=(new farallonBase,function(t){function e(){var e=t.call(this)||this;return e.selctor=".like-btn",e.is_single=!1,e.post_id=0,e.is_archive=!1,e.is_single=obvInit.is_single,e.post_id=obvInit.post_id,e.is_archive=obvInit.is_archive,e.like_btn=document.querySelector(e.selctor),e.like_btn&&(e.like_btn.addEventListener("click",function(){e.handleLike()}),e.getCookie("like_"+e.post_id))&&e.like_btn.classList.add("is-active"),console.log("init"),document.querySelector('[data-action="show-search"]').addEventListener("click",function(){document.querySelector(".site--header__center .inner").classList.toggle("search--active")}),document.querySelectorAll(".fixed--theme span").forEach(function(e){e.addEventListener("click",function(){document.querySelector("body").classList.toggle("dark--theme"),e.classList.toggle("is-active")})}),e.is_single&&e.trackPostView(),e.is_archive&&e.trackArchiveView(),e}return __extends(e,t),e.prototype.trackPostView=function(){var e=obvInit.post_id,e=obvInit.restfulBase+"farallon/v1/view?id="+e;fetch(e,{headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.log(e)})},e.prototype.trackArchiveView=function(){var e;document.querySelector(".archive-header")&&(e=document.querySelector(".archive-header").dataset.id,fetch("/api/archive/".concat(e)))},e.prototype.handleLike=function(){var t=this;if(this.getCookie("like_"+this.post_id))return this.showNotice("You have already liked this post");var e=obvInit.restfulBase+"farallon/v1/like";fetch(e,{method:"POST",body:JSON.stringify({id:this.post_id}),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.log(e),t.setCookie("like_"+t.post_id,"1",1)}),this.like_btn.classList.add("is-active")},e.prototype.refresh=function(){},e}(farallonBase)),farallonComment=(new farallonAction,function(t){function e(){var e=t.call(this)||this;return e.loading=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){var e,r=this;console.log("farallonComment"),document.querySelector(".comment-form")&&null!=(e=document.querySelector(".comment-form"))&&e.addEventListener("submit",function(e){var n;e.preventDefault(),r.loading||(e=document.querySelector(".comment-form"),e=new FormData(e),n={},e.forEach(function(e,t){return n[t]=e}),r.loading=!0,fetch(obvInit.restfulBase+"farallon/v1/comment",{method:"POST",body:JSON.stringify(n),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(r.loading=!1,200!=e.code)return r.showNotice(e.message,"error");var t=document.getElementById("cancel-comment-reply-link"),n=document.getElementById("respond"),o=document.getElementById("wp-temp-form-div"),e=e.data,i='<li class="comment" id="comment-'.concat(e.comment_ID,'">\n                        <div class="comment-body comment-body__fresh">\n                            <footer class="comment-meta">\n                                <div class="comment--avatar">\n                                    <img alt="" src="').concat(e.author_avatar_urls,'" class="avatar" height="42" width="42" />\n                                </div>\n                                <div class="comment--meta">\n                                    <div class="comment--author">').concat(e.comment_author,'<span class="dot"></span>\n                                    <time>刚刚</time>\n                                    </div>\n                                </div>\n                            </footer>\n                            <div class="comment-content">\n                                ').concat(e.comment_content,"\n                            </div>\n                        </div>\n                    </li>"),c=null==(c=document.querySelector("#comment_parent"))?void 0:c.value,t=(t.style.display="none",t.onclick=null,document.getElementById("comment_parent").value="0",o&&n&&(o.parentNode.insertBefore(n,o),o.parentNode.removeChild(o)),document.getElementById("comment").value="","0"!=c?(null!=(t=document.querySelector("#comment-"+c))&&t.insertAdjacentHTML("beforeend",'<ol class="children">'+i+"</ol>"),console.log(c)):(document.querySelector(".no--comment")&&null!=(n=document.querySelector(".no--comment"))&&n.remove(),null!=(o=document.querySelector(".commentlist"))&&o.insertAdjacentHTML("beforeend",i)),document.querySelector("#comment-".concat(e.comment_ID)));t&&t.scrollIntoView({behavior:"smooth"}),r.showNotice("评论成功")}))})},e}(farallonBase)),farallonDate=(new farallonComment,function(){function e(e){var t=this;this.doms=[],this.selector=e.selector,this.init(),setTimeout(function(){t.refresh()},5e3)}return e.prototype.init=function(){var t=this;this.doms=Array.from(document.querySelectorAll(this.selector)),this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e.prototype.humanize_time_ago=function(e){var e=new Date(e),t=Date.now()/1e3-Number(e.getTime()/1e3);return t<3600?"".concat(Math.ceil(t/60)," 分钟前"):t<86400?"".concat(Math.ceil(t/3600)," 小时前"):t<2592e3?"".concat(Math.ceil(t/2592e3)," 天前"):t<31104e3?"".concat(Math.ceil(t/31104e3)," 月前"):e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},e.prototype.refresh=function(){var t=this;this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e}()),farallonScroll=(new farallonDate({selector:".humane--time"}),function(){function e(){this.init()}return e.prototype.init=function(){this.scroll()},e.prototype.scroll=function(){window.addEventListener("scroll",function(){var e;10<window.scrollY?null!=(e=document.querySelector(".site--header"))&&e.classList.add("is-active"):null!=(e=document.querySelector(".site--header"))&&e.classList.remove("is-active")})},e}());new farallonScroll;